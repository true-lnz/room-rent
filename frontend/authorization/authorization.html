<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Регистрация и вход</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f5f5f5; padding: 20px; }
    .container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 { margin-bottom: 20px; color: #2a5885; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input[type="email"], input[type="password"] {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;
    }
    .role-group { margin-top: 10px; }
    .btn {
      padding: 10px; background-color: #2a5885; color: white; border: none;
      width: 100%; border-radius: 4px; cursor: pointer; font-size: 16px;
    }
    .btn:hover { background-color: #1d3f64; }
    .toggle { text-align: center; margin-top: 20px; cursor: pointer; color: #2a5885; }
  </style>
</head>
<body>

<div class="container" id="register-container">
  <h2>Регистрация</h2>
  <div class="form-group">
    <label for="reg-email">Email</label>
    <input type="email" id="reg-email" required>
  </div>
  <div class="form-group">
    <label for="reg-password">Пароль</label>
    <input type="password" id="reg-password" required>
  </div>
  <div class="form-group">
    <label for="reg-confirm">Повторите пароль</label>
    <input type="password" id="reg-confirm" required>
  </div>
  <div class="form-group">
    <label>Роль:</label>
    <div class="role-group">
      <label><input type="radio" name="role" value="owner" checked> Сдаю</label>
      <label><input type="radio" name="role" value="renter"> Арендую</label>
    </div>
  </div>
  <button class="btn" onclick="register()">Зарегистрироваться</button>
  <div class="toggle" onclick="showLogin()">Уже есть аккаунт? Войти</div>
</div>

<div class="container" id="login-container" style="display:none">
  <h2>Вход</h2>
  <div class="form-group">
    <label for="login-email">Email</label>
    <input type="email" id="login-email" required>
  </div>
  <div class="form-group">
    <label for="login-password">Пароль</label>
    <input type="password" id="login-password" required>
  </div>
  <button class="btn" onclick="login()">Войти</button>
  <div class="toggle" onclick="showRegister()">Нет аккаунта? Зарегистрироваться</div>
</div>

<script>
  function showLogin() {
    document.getElementById("register-container").style.display = "none";
    document.getElementById("login-container").style.display = "block";
  }

  function showRegister() {
    document.getElementById("register-container").style.display = "block";
    document.getElementById("login-container").style.display = "none";
  }

  async function register() {
    const email = document.getElementById("reg-email").value;
    const password = document.getElementById("reg-password").value;
    const confirm = document.getElementById("reg-confirm").value;
    const role = document.querySelector('input[name="role"]:checked').value;

    if (password !== confirm) {
      alert("Пароли не совпадают");
      return;
    }

    const res = await fetch("/api/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password, role })
    });

    if (res.ok) {
      alert("Регистрация прошла успешно");
      showLogin();
    } else {
      const err = await res.text();
      alert("Ошибка: " + err);
    }
  }

  async function login() {
    const email = document.getElementById("login-email").value;
    const password = document.getElementById("login-password").value;

    const res = await fetch("http://localhost:8080/api/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    if (res.ok) {
      const data = await res.json();
      localStorage.setItem("token", data.token); // сохраняем токен
      alert("Вход выполнен!");
      window.location.href = "/";
    } else {
      const err = await res.text();
      alert("Ошибка: " + err);
    }
  }
</script>

</body>
</html>
